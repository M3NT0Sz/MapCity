<!DOCTYPE html>
<html>
<head>
    <title>Teste de Imagens - MapCity</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .image-container { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .image-preview { width: 150px; height: 150px; object-fit: cover; margin: 10px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Teste de Carregamento de Imagens - MapCity</h1>
    
    <div id="loading">Carregando dados...</div>
    <div id="results"></div>

    <script>
        async function testarImagens() {
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            
            try {
                loadingDiv.innerHTML = '<div class="info">Fazendo requisição para http://localhost:3001/lugares...</div>';
                
                const response = await fetch('http://localhost:3001/lugares');
                const dados = await response.json();
                
                loadingDiv.innerHTML = '<div class="success">Dados carregados com sucesso!</div>';
                
                resultsDiv.innerHTML = `<h2>Total de registros: ${dados.length}</h2>`;
                
                dados.forEach((lugar, index) => {
                    const container = document.createElement('div');
                    container.className = 'image-container';
                    
                    let conteudo = `
                        <h3>Registro ${index + 1} - ID: ${lugar.id}</h3>
                        <p><strong>Nome:</strong> ${lugar.nome}</p>
                        <p><strong>Tipo:</strong> ${lugar.tipo}</p>
                        <p><strong>Descrição:</strong> ${lugar.descricao}</p>
                        <p><strong>Tem imagem:</strong> ${lugar.imagem ? 'Sim' : 'Não'}</p>
                    `;
                    
                    if (lugar.imagem) {
                        conteudo += `<p><strong>Tipo da imagem:</strong> ${typeof lugar.imagem}</p>`;
                        conteudo += `<p><strong>Imagem (primeiros 100 chars):</strong> ${JSON.stringify(lugar.imagem).substring(0, 100)}...</p>`;
                        
                        // Tentar renderizar a imagem
                        if (Array.isArray(lugar.imagem)) {
                            conteudo += `<p><strong>Array de ${lugar.imagem.length} imagem(ns):</strong></p>`;
                            lugar.imagem.forEach((img, imgIndex) => {
                                conteudo += `<img class="image-preview" src="http://localhost:3001${img}" alt="Imagem ${imgIndex + 1}" onerror="this.style.border='2px solid red'; this.alt='ERRO AO CARREGAR'">`;
                            });
                        } else if (typeof lugar.imagem === 'string') {
                            try {
                                const parsed = JSON.parse(lugar.imagem);
                                if (Array.isArray(parsed)) {
                                    conteudo += `<p><strong>JSON Array de ${parsed.length} imagem(ns):</strong></p>`;
                                    parsed.forEach((imgData, imgIndex) => {
                                        const src = imgData.data || imgData;
                                        conteudo += `<img class="image-preview" src="${src}" alt="Imagem ${imgIndex + 1}" onerror="this.style.border='2px solid red'; this.alt='ERRO AO CARREGAR'">`;
                                    });
                                } else {
                                    const src = parsed.data || parsed;
                                    conteudo += `<p><strong>JSON Objeto único:</strong></p>`;
                                    conteudo += `<img class="image-preview" src="${src}" alt="Imagem única" onerror="this.style.border='2px solid red'; this.alt='ERRO AO CARREGAR'">`;
                                }
                            } catch (e) {
                                conteudo += `<p><strong>String base64 direta:</strong></p>`;
                                conteudo += `<img class="image-preview" src="${lugar.imagem}" alt="Imagem base64" onerror="this.style.border='2px solid red'; this.alt='ERRO AO CARREGAR'">`;
                            }
                        }
                    }
                    
                    container.innerHTML = conteudo;
                    resultsDiv.appendChild(container);
                });
                
            } catch (error) {
                loadingDiv.innerHTML = `<div class="error">Erro: ${error.message}</div>`;
                console.error('Erro ao carregar dados:', error);
            }
        }
        
        // Executar quando a página carregar
        window.addEventListener('load', testarImagens);
    </script>
</body>
</html>
